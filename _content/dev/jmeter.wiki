%title JMeter 
%toc

記錄/備忘一些 [[https://jmeter.apache.org/|Apache JMeter]] 的知識和實例。

= Documentation =
* User manual
 - Online: http://jmeter.apache.org/usermanual/
 - Offline: 'printable_docs' 目錄下有完整的 user manual (在目錄裏還包含一些 demo 的 .jmx 和幾個 .pdf 文檔，都有相當的參考意義); 'docs' 目錄下有 api 文檔; 
* Apache JMeter Wiki http://wiki.apache.org/jmeter/
* [[http://blazemeter.com/|BlazeMeter]] (JMeter 雲服務的供應商): <br>
  在他們的 knowledge base 裏有不少 JMeter 文檔和使用經驗。
  其中還包括了一些非常適合初學者的視頻教程.具體可以參考: <br>
  BlazeMeter JMeter Tutorials:
  http://community.blazemeter.com/knowledgebase/topics/10018-jmeter-tutorials

= Environment =
== Dependences ==
JMeter 是一個 pure Java application 所以要先準備 Java Runtime。
目前JMeter 2.12 的要求是 Java 6+
* 對於其他環境基本沒太大要求，應該是 Java runtime 可以工作的地方基本就可以運行 JMeter。
  官方 Wiki 有列出過所有測試過的系統: 
  http://wiki.apache.org/jmeter/JMeterAndOperatingSystemsTested
* 根據實際所做的測試，可能會需要一些特殊的依賴或配置。<br>
  比如: JDBC Driver 需要被配置,如果是測試 Database; SSL 環境需要被配置,如果用到了 SSL。<br>
  具體的可以讀一下 JMeter User manual 的 Getting Started 中 "Requirements" 一小節的描述。
  https://jmeter.apache.org/usermanual/get-started.html

== Installation ==
* 從 http://jmeter.apache.org/download_jmeter.cgi 下載最新的 Binaries 包。
* 解壓到目錄就可以使用。
* 如果以 GUI 方式啓動,則只需要運行 bin\jmeter ( windows 上是 bin\jmeter.bat ) <br>
  這個腳本會組裝參數隨後啓動 bin\ApacheJMeter.jar。
  運行前要保證 Java 環境正確,比如: JAVA_HOME

= Internals =
== Thread Group ==
Thread Group 是 JMeter 的基本調度單位,
通過對 Thread Group 參數(比如: Number of Threads; Loop Count )的設置來改變 Test 的所產生的壓力。
* 在 JMeter 中有 3 種 Thread Group, 一個 Test 中可以包含多個同類型的 Thread Group:
 # Thread Group - 標準 Thread Group
 # setUp Thread Group - 會在 Test 開始是限被執行的 Thread Group  (方便用戶做 Testing 的初始化)
 # tearDown Thread Group - 會在所有其它類型的 Thread Group 結束後執行的 Thread Group (方便做 cleanup 的工作)
* JMeter 關於 Thread Group 調度的實現相關的主要代碼在: [[https://github.com/apache/jmeter/blob/trunk/src/core/org/apache/jmeter/engine/StandardJMeterEngine.java|src/core/org/apache/jmeter/engine/StandardJMeterEngine.java]] 中。 
 - 在 `StandardJMeterEngine` 的 `public void run()` 這個方法中，
   可以看到  JMeter Engine 是如何調度 Test 中的所有 Thread Groups 。 <br>
   這個一個 `run()` 方法也是 JMeter Engine 從 `Runnable` Override 掉的調度 Thread 入口。
 - 在調度 Thread 中, Engine 將 Test 中同類型的 Thread Group 分別放到 3 個 Lists 裏。<br>
   隨後依照 Setup Thread Groups -> Thread Groups -> Teardown Thread Groups 的順序，
   依次執行這些 Thread Groups。<br>
   (注意: 在 JMeter 的代碼中,把 Teardown Thread Groups 命名為 `PostThreadGroup`. 
   UI 和手冊中的名字是 "tearDown Thread Group"。)
{{{
+-----------------------+    +----------------+    +-------------------------+
| Setup Thread Groups   |--->| Thread Groups  |--->| Teardown Thread Groups  |
|-----------------------|    |----------------|    |-------------------------|
| Setup Thread Group 1  |    | Thread Group 1 |    | Teardown Thread Group 1 |
| Setup Thread Group 2  |    | Thread Group 2 |    | Teardown Thread Group 2 |
| ...                   |    | ...            |    | ...                     |
| Setup Thread Group N  |    | Thread Group N |    | Teardown Thread Group N |
+-----------------------+    +----------------+    +-------------------------+
}}}

= Custom Extension / Plugin =
可以通過擴展 JMeter 來運行一些特殊的測試，
比如在 JMeter 的 Script 中運行自己或第三方的 JAR 文件中的程序;
或者支持測試一些特殊的 Protocol。
* 通過JMeter 的 BSF / BeanShell Sampler 中使用 Script 加載自己的 .jar 文件。
  比如: 使用 BenShell Script import 自己的 .jar 文件中的 Java Package。
  (這個 jar 文件要放在 JMeter classpath 裏，或者也可以放在 `lib` 目錄，
  這個目錄是默認的 classpath)。<br>
  具體的細節可以參考手冊中 BSF Sampler 的描述。
* 通過實現 JMeter component 的方式擴展 JMeter 。比如實現一個 JMeter 的 Sampler 。
  一個我簡化過的實現: https://github.com/xiongjia/scratch/tree/master/jmeter-example-sampler

