%title Database
%toc

= PostgreSQL =
== Documentation ==
* 在線手冊: http://www.postgresql.org/docs/ 
* 本地手册,在安装 Database server 時會附帶有使用手冊. 具體位置各操作系統會有區別。
  (比如: osx 用 Homebew 裝的 version 9.3.2, 在 `/usr/local/Cellar/postgresql/9.3.2/share/doc/postgresql/html`,
  下可以找到; Windows 上則可以在安裝目錄的下找 `doc\postgresql\html` )

== 日常操作 ==
=== 創建數據庫 ===
* initdb <br>
  - 創建 database cluster . database cluster 是 postgres 的 instance。
  有 2 種方式創建: `initdb` 或者 `pg_ctl` 的 init 操作。
  比如用 `initdb` 來創建: <br>
  `initdb -D <data dir> -U <superuser name> -W` <br>
   * -D 用來指定 database 數據文件位置
   * -U 用來指定管理員帳戶
   * -W 表示創建過程中詢問管理員的 password 
  - 創建完後，默認會有 3 個 databases。 
    2 個互為備份的 template  database: template0; template1。另一個為默認 database: postgres。
* 啟動/停止 database cluster <br>
  可以通過 `pg_ctl` 的 start/stop 操作來啟動或停止一個 database cluster。
  - 啟動: `pg_ctl -D <data dir> -l <log file name> start` 
  - 停止: `pg_ctl -D <data dir> stop`
    停止 database 時有 3 種 modes: "smart", "fast", or "immediate" <br>
    * 用 -m 參數指定 shutdown mode, 默認的 shutdown mode 為 smart.
    * 3 種 shutdown mode 會影響正在工作的 client, 正在處理的事務以及正在進行的備份。
      手冊種的描述: <br>
      Three different shutdown methods can be selected with the -m option. 
      "Smart" mode (the default) waits for all active clients to disconnect and any online backup to finish.
      If the server is in hot standby, recovery and streaming replication will be terminated once all clients have disconnected. 
      "Fast" mode does not wait for clients to disconnect and will terminate an online backup in progress. 
      All active transactions are rolled back and clients are forcibly disconnected, 
      then the server is shut down. "Immediate" mode will abort all server processes immediately, 
      without a clean shutdown. This will lead to a crash-recovery run on the next restart.
* 創建 database <br>
  創建一個 database 實際上就是把 template database 複製一份，
  改名成用戶 database 並更新相關數據到 postgres 的系統表。<br>
  如果有需要用戶是可以指定自己的 template database 的, 用 `-T` 參數告訴 `createdb` 模板名。
  默認不指定 `createdb` 會用系統的 template1/template0 來做模板。<br>
  比如 (注意創建 database 前, database cluster 必須已啟動): <br>
  `createdb -U <superuser name> <database name> [database description]`
  - -U 是管理員帳號
  - database name 是新建的 database 名字
  - database description 可選，是數據庫的描述。
* 查看 databases
  database cluster 啟動後可以用 `psql` 默認的 postgres client 去查看。(也可以用 GUI 工具 pgAdmin )
  比如: `psql -U <username> <database name>` .進入 `psql` 後可用 `\l` 命令，來列出所有 database. 

